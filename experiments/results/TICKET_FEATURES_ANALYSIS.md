# Ticketç‰¹å¾´é‡ã®åˆ†æžã¨è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ

**æ—¥ä»˜**: 2025-10-24
**ç›®çš„**: Ticketæƒ…å ±ã‹ã‚‰æœ‰åŠ¹ãªç‰¹å¾´é‡ã‚’æŠ½å‡ºã—ã€ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ã¸ã®å½±éŸ¿ã‚’è©•ä¾¡

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒžãƒªãƒ¼

âœ… **çµè«–**: Ticketç‰¹å¾´é‡ã«ã‚ˆã‚Šã€GradientBoostingãƒ¢ãƒ‡ãƒ«ã§ **+0.0090 (+1.08%)** ã®ç²¾åº¦æ”¹å–„ã‚’ç¢ºèª

- å…¨6ã¤ã®Ticketç‰¹å¾´é‡ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆ0.8294ï¼‰ã‹ã‚‰ **0.8384** ã«å‘ä¸Š
- æœ€ã‚‚åŠ¹æžœçš„ãªå˜ç‹¬ç‰¹å¾´é‡: **Ticket_Is_Numeric** (+0.0067)
- ç‰¹å¾´é‡é‡è¦åº¦ã§ã€**Ticket_Fare_Per_Person**ï¼ˆä¸€äººã‚ãŸã‚Šé‹è³ƒï¼‰ãŒæ—¢å­˜ç‰¹å¾´é‡ã®Titleã«æ¬¡ã„ã§é‡è¦

---

## 1. Ticketãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç™ºè¦‹

### 1.1 åŸºæœ¬çµ±è¨ˆ

| é …ç›® | å€¤ |
|------|-----|
| ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒã‚±ãƒƒãƒˆæ•° | 929 |
| ç·ä¹—å®¢æ•° | 1,309 (Train + Test) |
| è¤‡æ•°äººã§å…±æœ‰ã•ã‚Œã¦ã„ã‚‹ãƒã‚±ãƒƒãƒˆ | 216 |
| ãƒã‚±ãƒƒãƒˆãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ç¨®é¡ž | 39 |

### 1.2 ä¸»è¦ãªTicketãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹

| Prefix | ä»¶æ•° | ç”Ÿå­˜çŽ‡ | å¹³å‡é‹è³ƒ | ç‰¹å¾´ |
|--------|------|--------|----------|------|
| NUMERIC | 957 | 38.4% | $27.13 | æ•°å­—ã®ã¿ï¼ˆæœ€å¤šï¼‰ |
| PC | 92 | 65.0% | $122.08 | **é«˜ç”Ÿå­˜çŽ‡ãƒ»é«˜é‹è³ƒ** |
| F_C_C | 9 | 80.0% | $22.05 | **æœ€é«˜ç”Ÿå­˜çŽ‡** |
| A | 39 | 7.1% | $10.04 | **ä½Žç”Ÿå­˜çŽ‡** |
| CA | 22 | 7.1% | $55.41 | **ä½Žç”Ÿå­˜çŽ‡** |
| W_C | 15 | 10.0% | $22.35 | **ä½Žç”Ÿå­˜çŽ‡** |

### 1.3 Ticketã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚ºã¨ç”Ÿå­˜çŽ‡

| ã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚º | ç”Ÿå­˜çŽ‡ | ä»¶æ•° |
|----------------|--------|------|
| 1ï¼ˆå˜ç‹¬ï¼‰ | 27.0% | 481 |
| 2 | 51.4% | 181 |
| 3 | 65.4% | 101 |
| 4 | **72.7%** | 44 |
| 5 | 33.3% | 21 |
| 6 | 21.1% | 19 |
| 7+ | 20-38% | 52 |

**ç™ºè¦‹**: ã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚º2-4ã§ç”Ÿå­˜çŽ‡ãŒé«˜ã„ï¼ˆ51-73%ï¼‰

---

## 2. å®Ÿè£…ã—ãŸTicketç‰¹å¾´é‡

### 2.1 6ã¤ã®Ticketç‰¹å¾´é‡

| ç‰¹å¾´é‡ | èª¬æ˜Ž | ã‚¿ã‚¤ãƒ— | å˜ç‹¬åŠ¹æžœ |
|--------|------|--------|----------|
| **Ticket_Is_Numeric** | æ•°å­—ã®ã¿ã®ãƒã‚±ãƒƒãƒˆã‹ | Binary | **+0.0067** |
| **Ticket_SmallGroup** | ã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚º2-4ã‹ | Binary | **+0.0056** |
| **Ticket_Prefix_Category** | é«˜/ä¸­/ä½Žç”Ÿå­˜çŽ‡ã‚«ãƒ†ã‚´ãƒª | Categorical | **+0.0045** |
| **Ticket_GroupSize** | ãƒã‚±ãƒƒãƒˆå…±æœ‰äººæ•° | Numeric | +0.0034 |
| **Ticket_Fare_Per_Person** | Fare / GroupSize | Numeric | +0.0034 |
| **Ticket_Length** | ãƒã‚±ãƒƒãƒˆæ–‡å­—åˆ—ã®é•·ã• | Numeric | +0.0011 |

### 2.2 ã‚«ãƒ†ã‚´ãƒªåˆ†é¡žãƒ­ã‚¸ãƒƒã‚¯

```python
# Ticket_Prefix_Category
HIGH (2):   ['F_C_C', 'PC']  # ç”Ÿå­˜çŽ‡ >60%
LOW (0):    ['SOTON_OQ', 'SOTON_O_Q', 'W_C', 'A', 'CA', 'S_O_C']  # ç”Ÿå­˜çŽ‡ <30%
MEDIUM (1): ãã®ä»–
```

---

## 3. ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ã¸ã®å½±éŸ¿

### 3.1 å…¨ä½“æ¯”è¼ƒï¼ˆGradientBoosting, CV=5ï¼‰

| ç‰¹å¾´é‡ã‚»ãƒƒãƒˆ | ç‰¹å¾´é‡æ•° | CV Score | æ”¹å–„ |
|--------------|----------|----------|------|
| **Baseline** | 11 | 0.8294 | - |
| **Baseline + All Ticket** | 17 | **0.8384** | **+0.0090** |
| Baseline + Top3 Ticket | 14 | 0.8305 | +0.0011 |

### 3.2 ãƒ¢ãƒ‡ãƒ«åˆ¥ã®åŠ¹æžœï¼ˆAll Ticketç‰¹å¾´é‡ï¼‰

| ãƒ¢ãƒ‡ãƒ« | Baseline | +Ticket | æ”¹å–„ | æ”¹å–„çŽ‡ |
|--------|----------|---------|------|--------|
| **GradientBoosting** | 0.8294 | **0.8384** | **+0.0090** | **+1.08%** |
| **LightGBM** | 0.8361 | 0.8384 | +0.0023 | +0.27% |
| RandomForest | 0.8339 | 0.8361 | +0.0022 | +0.27% |
| LogisticRegression | 0.8036 | 0.7913 | -0.0123 | -1.53% |

**æœ€è‰¯çµæžœ**: GradientBoosting + All Ticket = **0.8384**

---

## 4. ç‰¹å¾´é‡é‡è¦åº¦åˆ†æž

### 4.1 GradientBoostingã§ã®ç‰¹å¾´é‡é‡è¦åº¦ï¼ˆTop 10ï¼‰

| é †ä½ | ç‰¹å¾´é‡ | é‡è¦åº¦ | ã‚«ãƒ†ã‚´ãƒª |
|------|--------|--------|----------|
| 1 | Title | 0.5085 | æ—¢å­˜ |
| **2** | **Ticket_Fare_Per_Person** | **0.1388** | **Ticket** |
| 3 | Pclass | 0.0889 | æ—¢å­˜ |
| 4 | Fare | 0.0839 | æ—¢å­˜ |
| **5** | **Ticket_GroupSize** | **0.0666** | **Ticket** |
| 6 | FamilySize | 0.0296 | æ—¢å­˜ |
| 7 | Sex | 0.0271 | æ—¢å­˜ |
| **8** | **Ticket_Length** | **0.0227** | **Ticket** |

**ç™ºè¦‹**: Ticket_Fare_Per_PersonãŒ2ç•ªç›®ã«é‡è¦ãªç‰¹å¾´é‡ï¼

### 4.2 RandomForestã§ã®ç‰¹å¾´é‡é‡è¦åº¦ï¼ˆTop 10ï¼‰

| é †ä½ | ç‰¹å¾´é‡ | é‡è¦åº¦ |
|------|--------|--------|
| 1 | Sex | 0.2563 |
| 2 | Title | 0.2561 |
| 3 | Fare | 0.0888 |
| **4** | **Ticket_Fare_Per_Person** | **0.0857** |
| 5 | Pclass | 0.0795 |

---

## 5. ç›¸é–¢åˆ†æžã¨å¤šé‡å…±ç·šæ€§

### 5.1 Ticketç‰¹å¾´é‡é–“ã®é«˜ç›¸é–¢

| ç‰¹å¾´é‡1 | ç‰¹å¾´é‡2 | ç›¸é–¢ | å¯¾å‡¦ |
|---------|---------|------|------|
| Ticket_Length | Ticket_Is_Numeric | **-0.758** | âš ï¸ æ³¨æ„ |

### 5.2 æ—¢å­˜ç‰¹å¾´é‡ã¨ã®é«˜ç›¸é–¢

| Ticketç‰¹å¾´é‡ | æ—¢å­˜ç‰¹å¾´é‡ | ç›¸é–¢ | ç†ç”± |
|--------------|------------|------|------|
| Ticket_GroupSize | FamilySize | **+0.816** | å®¶æ—ã¯ãƒã‚±ãƒƒãƒˆå…±æœ‰ |
| Ticket_SmallGroup | SmallFamily | **+0.706** | åŒã˜æ¦‚å¿µ |
| Ticket_Fare_Per_Person | Fare | **+0.827** | æ´¾ç”Ÿå¤‰æ•° |
| Ticket_Fare_Per_Person | Pclass | **-0.763** | Pclassã¨é‹è³ƒã®é–¢ä¿‚ |

**çµè«–**: å¤šé‡å…±ç·šæ€§ã®å¯èƒ½æ€§ã‚ã‚Šã€‚ãŸã ã—ã€Ticket_Fare_Per_Personã¯å…ƒã®Fareã¨ã¯ç•°ãªã‚‹æƒ…å ±ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚ºã§èª¿æ•´ï¼‰ã‚’æä¾›ã—ã¦ã„ã‚‹

---

## 6. æŽ¨å¥¨äº‹é …

### âœ… æŽ¨å¥¨ã™ã‚‹ç‰¹å¾´é‡ã‚»ãƒƒãƒˆ

**Option 1: All Ticketï¼ˆæœ€è‰¯æ€§èƒ½ï¼‰**
- å…¨6ã¤ã®Ticketç‰¹å¾´é‡ã‚’è¿½åŠ 
- **æœŸå¾…æ”¹å–„: +0.0090** (GradientBoosting)
- ç‰¹å¾´é‡æ•°: 17

**Option 2: Top3 Ticketï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰**
- `Ticket_Is_Numeric`, `Ticket_SmallGroup`, `Ticket_Prefix_Category`
- æœŸå¾…æ”¹å–„: +0.0056
- ç‰¹å¾´é‡æ•°: 14

### âš ï¸ æ³¨æ„ç‚¹

1. **å¤šé‡å…±ç·šæ€§**: Ticket_GroupSize ã¨ FamilySize ã¯é«˜ç›¸é–¢ï¼ˆ0.816ï¼‰
   - ãŸã ã—ã€ä¸¡æ–¹ã‚’å«ã‚ãŸæ–¹ãŒæ€§èƒ½ãŒè‰¯ã„ï¼ˆAll Ticket: +0.0090ï¼‰
   - Tree-basedãƒ¢ãƒ‡ãƒ«ã¯å¤šé‡å…±ç·šæ€§ã«å¼·ã„

2. **LogisticRegressionã§ã¯æ‚ªåŒ–**: -0.0123
   - ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã¯å¤šé‡å…±ç·šæ€§ã«å¼±ã„
   - æ­£å‰‡åŒ–ã‚„ç‰¹å¾´é‡é¸æŠžãŒå¿…è¦

3. **Ticket_Fare_Per_Personã®é‡è¦æ€§**:
   - GradientBoostingã§2ç•ªç›®ã«é‡è¦
   - Fareã¨Ticket_GroupSizeã®ç›¸äº’ä½œç”¨ã‚’æ‰ãˆã¦ã„ã‚‹

### ðŸŽ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **All Ticketç‰¹å¾´é‡ã§ãƒ¢ãƒ‡ãƒ«å†è¨“ç·´**
   - GradientBoostingã§ã®æ”¹å–„ï¼ˆ+1.08%ï¼‰ã‚’æœ€çµ‚ãƒ¢ãƒ‡ãƒ«ã«çµ„ã¿è¾¼ã‚€

2. **Optunaæœ€é©åŒ–ã¨ã®çµ„ã¿åˆã‚ã›**
   - ç¾åœ¨ã®æœ€è‰¯ãƒ¢ãƒ‡ãƒ«ï¼ˆOptunaæœ€é©åŒ–ï¼‰ã«Ticketç‰¹å¾´é‡ã‚’è¿½åŠ 

3. **Ensembleäºˆæ¸¬**
   - Ticketç‰¹å¾´é‡ã‚’å«ã‚€ãƒ¢ãƒ‡ãƒ«ã¨å«ã¾ãªã„ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«

4. **ã•ã‚‰ãªã‚‹æ´¾ç”Ÿç‰¹å¾´é‡ã®æ¤œè¨Ž**
   - Ticket_Fare_Per_Person Ã— Pclass
   - Ticket_GroupSize Ã— Sex

---

## 7. æŠ€è¡“çš„è©³ç´°

### 7.1 å®Ÿè£…ã‚³ãƒ¼ãƒ‰

```python
# Ticketç‰¹å¾´é‡ã®æŠ½å‡º
def extract_ticket_prefix(ticket):
    ticket = str(ticket).strip()
    if ticket.replace('.', '').isdigit():
        return 'NUMERIC'
    match = re.match(r'^([A-Za-z./\s]+)', ticket)
    if match:
        prefix = match.group(1).strip()
        prefix = re.sub(r'[./\s]+', '_', prefix)
        prefix = prefix.strip('_')
        return prefix.upper()
    return 'OTHER'

# ã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚ºã¯ Train + Test ã‚’çµåˆã—ã¦è¨ˆç®—
combined = pd.concat([train, test], axis=0)
ticket_counts = combined.groupby('Ticket').size()
combined['Ticket_GroupSize'] = combined['Ticket'].map(ticket_counts)

# ä¸€äººã‚ãŸã‚Šé‹è³ƒ
combined['Ticket_Fare_Per_Person'] = combined['Fare'] / combined['Ticket_GroupSize']
```

### 7.2 è©•ä¾¡æ–¹æ³•

- **Cross-Validation**: StratifiedKFold, 5 folds, random_state=42
- **è©•ä¾¡æŒ‡æ¨™**: Accuracy
- **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³**: æ—¢å­˜ã®11ç‰¹å¾´é‡ï¼ˆPclass, Sex, SibSp, Parch, Fare, Title, FamilySize, SmallFamily, Embarkedï¼‰

---

## 8. çµè«–

Ticketæƒ…å ±ã‹ã‚‰æŠ½å‡ºã—ãŸç‰¹å¾´é‡ã¯ã€**GradientBoostingãƒ¢ãƒ‡ãƒ«ã§+1.08%ã®æ”¹å–„**ã‚’ã‚‚ãŸã‚‰ã—ã¾ã—ãŸã€‚

**ä¸»è¦ãªç™ºè¦‹**:
1. **Ticket_Fare_Per_Person**ï¼ˆä¸€äººã‚ãŸã‚Šé‹è³ƒï¼‰ãŒéžå¸¸ã«é‡è¦ãªç‰¹å¾´é‡
2. **Ticket_Is_Numeric**ï¼ˆæ•°å­—ã®ã¿ã®ãƒã‚±ãƒƒãƒˆï¼‰ãŒå˜ç‹¬ã§æœ€ã‚‚åŠ¹æžœçš„ï¼ˆ+0.0067ï¼‰
3. å…¨6ã¤ã®Ticketç‰¹å¾´é‡ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§æœ€è‰¯ã®çµæžœï¼ˆ+0.0090ï¼‰

**æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
- å…¨6ã¤ã®Ticketç‰¹å¾´é‡ã‚’æœ€çµ‚ãƒ¢ãƒ‡ãƒ«ã«çµ„ã¿è¾¼ã‚€
- ç‰¹ã«ã€Ticket_Fare_Per_Personã¯å¿…é ˆ

---

**ç”Ÿæˆæ—¥**: 2025-10-24
**åˆ†æžã‚¹ã‚¯ãƒªãƒ—ãƒˆ**:
- `scripts/feature_engineering/ticket_pattern_analysis.py`
- `scripts/feature_engineering/ticket_feature_evaluation.py`
- `scripts/feature_engineering/ticket_feature_importance_analysis.py`
