# Ticketç‰¹å¾´é‡ Ã— LogisticRegression æœ€é©åŒ–åˆ†æ

**æ—¥ä»˜**: 2025-10-24
**ç›®çš„**: LogisticRegressionã§æ‚ªåŒ–ã™ã‚‹Ticketç‰¹å¾´é‡ã‚’æœ€é©åŒ–ã—ã€ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã§ã‚‚ä½¿ãˆã‚‹ã‹æ¤œè¨¼

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

âŒ **çµè«–**: **Ticketç‰¹å¾´é‡ã¯LogisticRegressionã§ã¯æ¨å¥¨ã—ãªã„**

- ã©ã®ç‰¹å¾´é‡é¸æŠæˆ¦ç•¥ã‚‚æ”¹å–„ãªã—ï¼ˆ-0.78% ï½ -1.26%ã®æ‚ªåŒ–ï¼‰
- æ ¹æœ¬åŸå› : SibSp/Parch/FamilySize/Ticket_GroupSizeé–“ã®æ·±åˆ»ãªå¤šé‡å…±ç·šæ€§ï¼ˆVIF = âˆï¼‰
- æ­£å‰‡åŒ–å¼·åŒ–ï¼ˆC=0.1ï¼‰ã§ã‚‚æ‚ªåŒ–ï¼ˆ-0.33%ï¼‰

**æ¨å¥¨**:
- **Tree-basedãƒ¢ãƒ‡ãƒ«**: å…¨Ticketç‰¹å¾´é‡ä½¿ç”¨ âœ… (+1.08%)
- **ç·šå½¢ãƒ¢ãƒ‡ãƒ«**: Ticketç‰¹å¾´é‡ãªã— âœ… (ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç¶­æŒ)

---

## 1. å•é¡Œã®è¨ºæ–­

### 1.1 å…ƒã®çµæœ

| ãƒ¢ãƒ‡ãƒ« | Baseline | +All Ticket | å¤‰åŒ– |
|--------|----------|-------------|------|
| GradientBoosting | 0.8294 | 0.8384 | **+0.0090** âœ… |
| LightGBM | 0.8361 | 0.8384 | +0.0023 âœ… |
| RandomForest | 0.8339 | 0.8361 | +0.0022 âœ… |
| **LogisticRegression** | 0.8036 | 0.7913 | **-0.0123** âŒ |

### 1.2 VIFåˆ†æï¼ˆå¤šé‡å…±ç·šæ€§è¨ºæ–­ï¼‰

**åŸºæº–**: VIF > 10 ã¯å•é¡Œã€VIF > 5 ã¯è¦æ³¨æ„

| ç‰¹å¾´é‡ | VIF | åˆ¤å®š |
|--------|-----|------|
| **SibSp** | **âˆ** | ğŸ”´ å®Œå…¨ãªç·šå½¢ä¾å­˜ |
| **FamilySize** | **âˆ** | ğŸ”´ å®Œå…¨ãªç·šå½¢ä¾å­˜ |
| **Parch** | **âˆ** | ğŸ”´ å®Œå…¨ãªç·šå½¢ä¾å­˜ |
| **Ticket_Fare_Per_Person** | **9.53** | ğŸ”´ æ·±åˆ» |
| **Fare** | **7.71** | ğŸŸ  å•é¡Œã‚ã‚Š |
| **Ticket_GroupSize** | **5.86** | ğŸŸ  è¦æ³¨æ„ |
| Pclass | 3.02 | ğŸŸ¢ OK |
| Ticket_Is_Numeric | 2.92 | ğŸŸ¢ OK |

**ç™ºè¦‹**: SibSp, Parch, FamilySizeãŒå®Œå…¨ã«ç·šå½¢ä¾å­˜ï¼
```
FamilySize = SibSp + Parch + 1
```

### 1.3 é«˜ç›¸é–¢ãƒšã‚¢ï¼ˆ|r| > 0.6ï¼‰

| ç‰¹å¾´é‡1 | ç‰¹å¾´é‡2 | ç›¸é–¢ | å•é¡Œ |
|---------|---------|------|------|
| SibSp | FamilySize | **+0.891** | ğŸ”´ |
| SibSp | Ticket_GroupSize | **+0.727** | ğŸ”´ |
| Parch | FamilySize | **+0.783** | ğŸ”´ |
| Parch | Ticket_GroupSize | **+0.638** | ğŸ”´ |
| **FamilySize** | **Ticket_GroupSize** | **+0.816** | ğŸ”´ |
| **SmallFamily** | **Ticket_SmallGroup** | **+0.706** | ğŸ”´ |
| **Fare** | **Ticket_Fare_Per_Person** | **+0.827** | ğŸ”´ |
| Pclass | Ticket_Fare_Per_Person | **-0.763** | ğŸ”´ |
| Ticket_Length | Ticket_Is_Numeric | **-0.758** | ğŸ”´ |

**å•é¡Œ**: Ticketç‰¹å¾´é‡ã®å¤šããŒæ—¢å­˜ç‰¹å¾´é‡ã¨é«˜ç›¸é–¢

---

## 2. è©¦ã—ãŸ4ã¤ã®æˆ¦ç•¥

### Strategy 1: é«˜VIFç‰¹å¾´é‡ã‚’é™¤å¤–

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: FamilySize, Fareã‚’é™¤å¤–ã—ã€ä»£ã‚ã‚Šã«Ticketç‰¹å¾´é‡ã‚’ä½¿ç”¨

```
é™¤å¤–: FamilySize, Fare
è¿½åŠ : Ticket_GroupSize, Ticket_Fare_Per_Person, Ticket_Is_Numeric,
      Ticket_Prefix_Category, Ticket_Length, Ticket_SmallGroup
```

**çµæœ**: 0.7958 (**-0.0078**, -0.97%) âŒ

### Strategy 2: Ticketé‡è¤‡é™¤å¤–

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: æ—¢å­˜ç‰¹å¾´é‡ã¨é‡è¤‡ã—ãªã„Ticketç‰¹å¾´é‡ã®ã¿ä½¿ç”¨

```
é™¤å¤–: ãªã—
è¿½åŠ : Ticket_Is_Numeric, Ticket_Prefix_Category, Ticket_Length
(é™¤å¤–Ticket: GroupSize, SmallGroup, FarePerPerson)
```

**çµæœ**: 0.7947 (**-0.0090**, -1.13%) âŒ

### Strategy 3: æœ€å°æ§‹æˆ

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: æœ€ã‚‚ç‹¬ç«‹æ€§ã®é«˜ã„Ticketç‰¹å¾´é‡ã®ã¿

```
é™¤å¤–: FamilySize
è¿½åŠ : Ticket_Is_Numeric, Ticket_Prefix_Category
```

**çµæœ**: 0.7935 (**-0.0101**, -1.26%) âŒ

### Strategy 4: Fareç³»çµ±ä¸€ â­ æœ€è‰¯

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: Fareã‚’Ticket_Fare_Per_Personã«ç½®ãæ›ãˆ

```
é™¤å¤–: Fare
è¿½åŠ : Ticket_Fare_Per_Person, Ticket_Is_Numeric,
      Ticket_Prefix_Category, Ticket_SmallGroup
```

**çµæœ**: 0.7958 (**-0.0078**, -0.97%) âŒ

**VIFæ”¹å–„**: Ticket_Fare_Per_Person VIF = 2.72ï¼ˆè¨±å®¹ç¯„å›²ï¼‰

---

## 3. æ­£å‰‡åŒ–ã®èª¿æ•´

å…¨Ticketç‰¹å¾´é‡ã‚’ä½¿ç”¨ã—ã€æ­£å‰‡åŒ–å¼·åº¦Cã‚’èª¿æ•´ï¼š

| Cå€¤ | æ­£å‰‡åŒ– | CV Score | å¤‰åŒ– |
|-----|--------|----------|------|
| 0.01 | è¶…å¼· | 0.7587 | **-0.0449** âŒ |
| 0.10 | å¼· | 0.8003 | **-0.0033** âŒ |
| 0.50 | ä¸­ | 0.7913 | -0.0123 âŒ |
| 1.00 | å¼±ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ | 0.7913 | -0.0123 âŒ |
| 2.00ï½10.00 | è¶…å¼± | 0.7902 | -0.0134 âŒ |

**ç™ºè¦‹**: æ­£å‰‡åŒ–ã‚’å¼·ãã—ã¦ã‚‚æ”¹å–„ã›ãš

---

## 4. ãªãœLogisticRegressionã§æ‚ªåŒ–ã™ã‚‹ã®ã‹ï¼Ÿ

### 4.1 Tree-basedãƒ¢ãƒ‡ãƒ« vs ç·šå½¢ãƒ¢ãƒ‡ãƒ«

| ç‰¹æ€§ | Tree-based | ç·šå½¢ãƒ¢ãƒ‡ãƒ« |
|------|------------|------------|
| **å¤šé‡å…±ç·šæ€§ã¸ã®è€æ€§** | ğŸŸ¢ å¼·ã„ | ğŸ”´ å¼±ã„ |
| **ç‰¹å¾´é‡é¸æŠ** | è‡ªå‹•ï¼ˆåˆ†å‰²ã§é¸æŠï¼‰ | ã™ã¹ã¦åŒæ™‚ã«ä½¿ç”¨ |
| **ç›¸äº’ä½œç”¨** | ğŸŸ¢ è‡ªå‹•æ¤œå‡º | æ‰‹å‹•ã§ä½œæˆå¿…è¦ |
| **è§£é‡ˆæ€§** | ä¸­ | ğŸŸ¢ é«˜ã„ |

### 4.2 Tree-basedãƒ¢ãƒ‡ãƒ«ã§ã®å‹•ä½œ

```
GradientBoostingã®åˆ†å‰²ä¾‹:

Node 1: FamilySize ã§åˆ†å‰²
â”œâ”€ FamilySize <= 3: Ticket_Fare_Per_Person ã§åˆ†å‰²
â””â”€ FamilySize > 3: Pclass ã§åˆ†å‰²

â†’ Ticket_GroupSize ã¯ä½¿ã‚ãªã„ï¼ˆFamilySizeã¨é‡è¤‡ï¼‰
â†’ è‡ªå‹•çš„ã«æœ€é©ãªç‰¹å¾´é‡ã‚’é¸æŠ
```

**åˆ©ç‚¹**: å†—é•·ãªç‰¹å¾´é‡ãŒã‚ã£ã¦ã‚‚å•é¡Œãªã—ï¼ˆä½¿ã‚ãªã„ï¼‰

### 4.3 LogisticRegressionã§ã®å‹•ä½œ

```
Survived = Î²â‚€ + Î²â‚Â·FamilySize + Î²â‚‚Â·Ticket_GroupSize + ...

å•é¡Œ: FamilySize ã¨ Ticket_GroupSize ãŒé«˜ç›¸é–¢ï¼ˆ0.816ï¼‰
â†’ ã©ã¡ã‚‰ã®ä¿‚æ•°ãŒå¤§ãã„ã‹ä¸å®‰å®š
â†’ ä¿‚æ•°ã®æ¨å®šèª¤å·®ãŒå¤§ãããªã‚‹
â†’ æ±åŒ–æ€§èƒ½ãŒä¸‹ãŒã‚‹
```

**çµæœ**: å¤šé‡å…±ç·šæ€§ã«ã‚ˆã‚Šä¿‚æ•°ãŒä¸å®‰å®š â†’ æ€§èƒ½æ‚ªåŒ–

---

## 5. æœ€çµ‚æ¨å¥¨äº‹é …

### âœ… æ¨å¥¨æ§‹æˆï¼ˆãƒ¢ãƒ‡ãƒ«åˆ¥ï¼‰

| ãƒ¢ãƒ‡ãƒ«ã‚¿ã‚¤ãƒ— | Ticketç‰¹å¾´é‡ | æœŸå¾…æ”¹å–„ | ç†ç”± |
|--------------|--------------|----------|------|
| **GradientBoosting** | å…¨6ç‰¹å¾´é‡ | **+0.0090** | è‡ªå‹•ã§ç‰¹å¾´é‡é¸æŠ |
| **LightGBM** | å…¨6ç‰¹å¾´é‡ | +0.0023 | åŒä¸Š |
| **RandomForest** | å…¨6ç‰¹å¾´é‡ | +0.0022 | åŒä¸Š |
| **LogisticRegression** | **ãªã—** | **0.0000** | å¤šé‡å…±ç·šæ€§å›é¿ |

### ğŸ¯ å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

```python
# ãƒ¢ãƒ‡ãƒ«å®šç¾©æ™‚ã«ç‰¹å¾´é‡ã‚’åˆ†ã‘ã‚‹

if model_name in ['GradientBoosting', 'LightGBM', 'RandomForest']:
    # Tree-based: å…¨Ticketç‰¹å¾´é‡ä½¿ç”¨
    features = base_features + [
        'Ticket_GroupSize',
        'Ticket_Fare_Per_Person',
        'Ticket_Is_Numeric',
        'Ticket_Prefix_Category',
        'Ticket_Length',
        'Ticket_SmallGroup'
    ]
elif model_name == 'LogisticRegression':
    # ç·šå½¢: ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç‰¹å¾´é‡ã®ã¿
    features = base_features
    # ã¾ãŸã¯L1æ­£å‰‡åŒ–ã§è‡ªå‹•é¸æŠ
    # model = LogisticRegression(penalty='l1', solver='saga')
```

### âš ï¸ ä»£æ›¿æ¡ˆï¼ˆã‚‚ã—ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã§Ticketæƒ…å ±ã‚’ä½¿ã†ãªã‚‰ï¼‰

**Option A: ç‰¹å¾´é‡ã‚’å³é¸**
- `Ticket_Is_Numeric` ã®ã¿è¿½åŠ ï¼ˆVIF=1.09, ç‹¬ç«‹æ€§é«˜ã„ï¼‰
- æœŸå¾…æ”¹å–„: ã‚ãšã‹ï¼ˆ+0.001ç¨‹åº¦ï¼‰

**Option B: L1æ­£å‰‡åŒ–ï¼ˆLassoï¼‰ã§è‡ªå‹•é¸æŠ**
```python
LogisticRegression(penalty='l1', solver='saga', C=0.1)
```

**Option C: PCA/æ¬¡å…ƒå‰Šæ¸›**
- Ticketç‰¹å¾´é‡ã‚’PCAã§1-2æ¬¡å…ƒã«åœ§ç¸®
- å¤šé‡å…±ç·šæ€§ã‚’è§£æ¶ˆ

ãŸã ã—ã€**ã„ãšã‚Œã‚‚æ”¹å–„ã¯é™å®šçš„**ã€‚ã‚·ãƒ³ãƒ—ãƒ«ã«Ticketç‰¹å¾´é‡ãªã—ãŒæœ€è‰¯ã€‚

---

## 6. æŠ€è¡“çš„ãªæ·±æ˜ã‚Š

### 6.1 å®Œå…¨ãªç·šå½¢ä¾å­˜ã®ä¾‹

```python
# ãªãœVIF = âˆ ã«ãªã‚‹ã®ã‹

# å®šç¾©ã‹ã‚‰æ˜ã‚‰ã‹:
FamilySize = SibSp + Parch + 1

# ã¤ã¾ã‚Š:
FamilySize = 1.0Â·SibSp + 1.0Â·Parch + 1.0

# ã“ã‚Œã¯å®Œå…¨ãªç·šå½¢ä¾å­˜ï¼ˆrank deficiencyï¼‰
# è¡Œåˆ—ãŒç‰¹ç•°è¡Œåˆ—ã«ãªã‚Šã€VIF = âˆ
```

### 6.2 å¤šé‡å…±ç·šæ€§ã®æ•°å¼çš„å½±éŸ¿

```
Var(Î²Ì‚â±¼) âˆ VIF_j Â· ÏƒÂ²

VIF_j = 1 / (1 - RÂ²_j)

RÂ²_j: ç‰¹å¾´é‡j ã‚’ä»–ã®ç‰¹å¾´é‡ã§å›å¸°ã—ãŸæ±ºå®šä¿‚æ•°
```

- Ticket_GroupSize â†’ FamilySize ã§å›å¸°: RÂ² = 0.666
- VIF = 1/(1-0.666) = **2.99**
- ä¿‚æ•°ã®åˆ†æ•£ãŒç´„3å€ã«å¢—åŠ  â†’ æ¨å®šãŒä¸å®‰å®š

---

## 7. çµè«–

### ğŸ¯ æœ€çµ‚çµè«–

**LogisticRegressionã§ã¯Ticketç‰¹å¾´é‡ã‚’ä½¿ã‚ãªã„**

**ç†ç”±**:
1. **æ·±åˆ»ãªå¤šé‡å…±ç·šæ€§**: VIF = âˆï¼ˆSibSp/Parch/FamilySizeï¼‰
2. **ã™ã¹ã¦ã®æˆ¦ç•¥ã§æ‚ªåŒ–**: -0.78% ï½ -1.26%
3. **æ­£å‰‡åŒ–ã§ã‚‚æ”¹å–„ãªã—**: C=0.1ã§ã‚‚-0.33%
4. **è¤‡é›‘æ€§ã®å¢—åŠ **: ç‰¹å¾´é‡æ•°ãŒå¢—ãˆã‚‹ã ã‘ã§ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

**Tree-basedãƒ¢ãƒ‡ãƒ«ã¨ã®ä½¿ã„åˆ†ã‘**:
- **Tree-based**: å…¨Ticketç‰¹å¾´é‡ä½¿ç”¨ â†’ **+1.08%æ”¹å–„** âœ…
- **ç·šå½¢ãƒ¢ãƒ‡ãƒ«**: Ticketç‰¹å¾´é‡ãªã— â†’ **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç¶­æŒ** âœ…

### ğŸ“Š æœ€çµ‚ã‚¹ã‚³ã‚¢æ¯”è¼ƒ

| ãƒ¢ãƒ‡ãƒ« | æ¨å¥¨æ§‹æˆ | CV Score |
|--------|----------|----------|
| GradientBoosting | Base + Ticket | **0.8384** |
| LightGBM | Base + Ticket | 0.8384 |
| RandomForest | Base + Ticket | 0.8361 |
| LogisticRegression | **Base only** | **0.8036** |

---

**ç”Ÿæˆæ—¥**: 2025-10-24
**åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/feature_engineering/ticket_features_for_linear_models.py`
